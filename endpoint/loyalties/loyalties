## Group Loyalties

## Loyalties Collection [/loyalties]
Loyalties endpoint allows you to create a loyalty card for a customer. Responses from this endpoint will be retuned in JSON format only.
>`Note:` The payload should be of `JSON` format for this endpoint. This endpoint accepts requests only if the content-type is `application/json`.

### Version
Current version of loyalties endpoint stands at v1. Version numbers will form part of the url used to access the resource.

```
GET /loyalties
```

>`Note:` Versioning information will be omitted in documentation henceforth. It is assumed that all endpoints will have this versioning information prepend to it.

>`Note:` Endpoint versioning is no longer functional. We are working our way through to enable this is future. For now, please replace /v1 with /api/secure.

> `Note:` It is mandatory for the client to negotiate the content-type as `application/json` as the current service is compatible only with this content-type.

> `Note:` When an request is sent, the `id` attribute is unknown and hence it must be null. When the actual card is created, the response will have the `id` populated.

### Loyalty
Loyalty as a resource represents following information. This is equivalent of a nectar card supplied to the customer.

| Property | Type | As request | As response | Description |
| :-------------------- | :---------- | :----------| :---------- | ------------------------------------------------------------ |
| id | string | `Required` | `Returned always` |Loyalty card number associated to the customer. |
| title | string | `Required` | `Returned always` |  Title of the customer registering for Loyalty card. |
| firstName | string | `Required` | `Returned always` |  First name of the customer registering for Loyalty card. |
| surname | string | `Required` | `Returned always` | Surname of the customer registering for Loyalty card. |
| telephoneNumber | string | `Required` | `Returned always` | Telephone number of the customer registering for Loyalty card. |
| flatNumber | string | `Required` when `houseNumber` and `houseName` are not available | `Returned always` | Flat number of the address if available |
| houseNumber | string | `Required` when `flatNumber` and `houseName` are not available | `Returned always` | House number of the address if available. |
| houseName | string | `Required` when `houseNumber` and `flatNumber` are not available | `Returned always` | House name of the address if available. |
| addressLine1 | string | `Optional` | `Returned always` | Address line 1. Typically contains building name / street etc... |
| addressLine2 | string | `Optional` | `Returned always` | Address line 2. Typically contains street / avenues etc... |
| postalTown | string | `Required` | `Returned always` | Postal town of the address. |
| county | string  |`Optional` | `Returned always` | County to which the address belongs. |
| postcode | string | `Required` | `Returned always` | Postcode of the address |
| emailAddress | string | `Required` | `Returned always` | Email address of the customer attempting to register for a Loyalty card. |

### Create loyalty card [POST /loyalties]
+ Request 'SUCCESS' (application/json)

  + Headers

            cid: 05e230bf-a9cf-4b31-bc54-d3a995f62526

  + Body

            {
                "loyalty": {
                    "id": null,
                    "title": "Mr",
                    "firstName": "Mark",
                    "surname": "Blair",
                    "telephoneNumber": "07404174628",
                    "flatNumber": "Flat 10",
                    "houseNumber": null,
                    "houseName": "Linden place",
                    "addressLine1": "Meadow Gardens",
                    "addressLine2": null,
                    "postalTown": "Staines",
                    "county": "Middlesex",
                    "postcode": "TW18 3HE",
                    "emailAddress": "test@bgdigitaltest.co.uk"
                }
            }

+ Response 200 (application/json)

            {
                "loyalty": {
                    "id": "91270909018",
                    "title": "Mr",
                    "firstName": "Mark",
                    "surname": "Blair",
                    "telephoneNumber": "07404174628",
                    "flatNumber": "Flat 10",
                    "houseNumber": null,
                    "houseName": "Linden place",
                    "addressLine1": "Meadow Gardens",
                    "addressLine2": null,
                    "postalTown": "Staines",
                    "county": "Middlesex",
                    "postcode": "TW18 3HE",
                    "emailAddress": "test@bgdigitaltest.co.uk"
                }
            }

+ Request 'Input validation' (application/json)

  + Headers

            cid: 05e230bf-a9cf-4b31-bc54-d3a995f62526

+ Response 400 (application/json)

              {
                  "status": "FAIL",
                  "data": {},
                  "errors": {
                      "postcode": "error.client.postcode.invalid"
                  },
                  "meta": {}
              }

+ Request 'Unable to create loyalty' (application/json)

  + Headers

            cid: 05e230bf-a9cf-4b31-bc54-d3a995f62526

+ Response 500 (application/json)

            {
                "status": "ERROR",
                "data": {},
                "errors": [
                    {
                        "code": "service",
                        "message": "error.system.pi.operation.fail"
                    }
                ],
                "meta": {}
            }
